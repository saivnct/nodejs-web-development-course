const ContractDAO = require('../db/ContractDAO');


exports.getContract = async (req, res, next) => {
  try{
    const contractAddr = req.params.contractAddr;

    const contract = await ContractDAO.GetByContractAddr(contractAddr);

    if (!contract){
      return res.status(200).json({
        //200 - OK
        status: 'success',
        data: {},
      });
    }

    if (contract.metadata){
      const buff = Buffer.from(contract.metadata, 'base64');


      const metadata = JSON.parse(buff.toString());
      console.log("metadata", metadata)
      console.log("abi", metadata.output.abi);
    }

    res.status(200).json({
      //200 - OK
      status: 'success',
      data: {
        contract: {
          ...contract,
          data: contract.data.toString('hex'),
        },
      },
    });
  }catch (e) {
    console.error(e);

    res.status(500).json({
      //200 - OK
      status: 'failed',
    });
  }

};

exports.verifiedContract = async (req, res, next) => {
  try{
    const contractAddr = req.params.contractAddr;


    const data = Buffer.from("608060405234801561001057600080FD5B5061005A6040518060400160405280601B81526020017F4F776E657220636F6E7472616374206465706C6F7965642062793A00000000008152503361011A60201B6101E91760201C565B336000806101000A81548173FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF021916908373FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF16021790555060008054906101000A900473FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1673FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF16600073FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF167F342827C97908E5E2F71151C08502A66D44B6F758E3AC2F1DE95F02EB95F0A73560405160405180910390A361034D565B6101B882826040516024016101309291906102EE565B6040516020818303038152906040527F319AF333000000000000000000000000000000000000000000000000000000007BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF19166020820180517BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF83818316178352505050506101BC60201B60201C565B5050565B6101DD816101D86101E060201B6102851761020160201B60201C565B60201C565B50565B60006A636F6E736F6C652E6C6F679050600080835160208501845AFA505050565B61021360201B6102CB17819050919050565B61021B61031E565B565B600081519050919050565B600082825260208201905092915050565B60005B8381101561025757808201518184015260208101905061023C565B60008484015250505050565B6000601F19601F8301169050919050565B600061027F8261021D565B6102898185610228565B9350610299818560208601610239565B6102A281610263565B840191505092915050565B600073FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF82169050919050565B60006102D8826102AD565B9050919050565B6102E8816102CD565B82525050565B600060408201905081810360008301526103088185610274565B905061031760208301846102DF565B9392505050565B7F4E487B7100000000000000000000000000000000000000000000000000000000600052605160045260246000FD5B6105208061035C6000396000F3FE608060405234801561001057600080FD5B50600436106100365760003560E01C8063893D20E81461003B578063A6F9DAE114610059575B600080FD5B610043610075565B6040516100509190610316565B60405180910390F35B610073600480360381019061006E9190610362565B61009E565B005B60008060009054906101000A900473FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF16905090565B60008054906101000A900473FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1673FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF163373FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF161461012C576040517F08C379A0000000000000000000000000000000000000000000000000000000008152600401610123906103EC565B60405180910390FD5B8073FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1660008054906101000A900473FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF1673FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF167F342827C97908E5E2F71151C08502A66D44B6F758E3AC2F1DE95F02EB95F0A73560405160405180910390A3806000806101000A81548173FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF021916908373FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF16021790555050565B61028182826040516024016101FF92919061048B565B6040516020818303038152906040527F319AF333000000000000000000000000000000000000000000000000000000007BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF19166020820180517BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF83818316178352505050506102A6565B5050565B60006A636F6E736F6C652E6C6F679050600080835160208501845AFA505050565B6102BD816102B56102856102C0565B63FFFFFFFF16565B50565B6102CB819050919050565B6102D36104BB565B565B600073FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF82169050919050565B6000610300826102D5565B9050919050565B610310816102F5565B82525050565B600060208201905061032B6000830184610307565B92915050565B600080FD5B61033F816102F5565B811461034A57600080FD5B50565B60008135905061035C81610336565B92915050565B60006020828403121561037857610377610331565B5B60006103868482850161034D565B91505092915050565B600082825260208201905092915050565B7F43616C6C6572206973206E6F74206F776E657200000000000000000000000000600082015250565B60006103D660138361038F565B91506103E1826103A0565B602082019050919050565B60006020820190508181036000830152610405816103C9565B9050919050565B600081519050919050565B60005B8381101561043557808201518184015260208101905061041A565B60008484015250505050565B6000601F19601F8301169050919050565B600061045D8261040C565B610467818561038F565B9350610477818560208601610417565B61048081610441565B840191505092915050565B600060408201905081810360008301526104A58185610452565B90506104B46020830184610307565B9392505050565B7F4E487B7100000000000000000000000000000000000000000000000000000000600052605160045260246000FDFEA26469706673582212208FF1A9926D39CC99A583C9F1928E90A84A7BBD617C41B5353955F985FE1DB9AD64736F6C63430008120033", "hex");
    const metaData = {
        "name": "Test",
        "description": "Test",
    }


    const result = await ContractDAO.VerifiedContract(contractAddr, true, data, JSON.stringify(metaData));
    // console.log(result);

    return res.status(200).json({
      //200 - OK
      status: 'success',
      data: {},
    });
  }catch (e) {
    console.error(e);

    res.status(500).json({
      //200 - OK
      status: 'failed',
    });
  }

};